{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">ðŸ“Š Analytics</h4>

<div class="row g-3">
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Tickets total</div>
      <div class="fs-4 fw-bold">{{ stats.total }}</div>
    </div></div>
  </div>
  <div class="col-md-3">
    <div class="card"><div class="card-body">
      <div class="text-muted">Tickets ouverts</div>
      <div class="fs-4 fw-bold">{{ stats.ouverts }}</div>
    </div></div>
  </div>
</div>

<div class="row g-3 mt-1">
  <div class="col-md-6">
    <div class="card"><div class="card-body">
      <h6>RÃ©partition par statut</h6>
      <canvas id="byStatut"></canvas>
    </div></div>
  </div>
  <div class="col-md-6">
    <div class="card"><div class="card-body">
      <h6>Top thÃ©matiques</h6>
      <canvas id="topThem"></canvas>
    </div></div>
  </div>
</div>

<script>
const byStatut = {{ stats.by_statut|tojson }};
const topThem  = {{ stats.top_them|tojson }};
document.addEventListener("DOMContentLoaded", () => {
  new Chart(document.getElementById('byStatut'), {
    type: 'pie',
    data: { labels: Object.keys(byStatut), datasets: [{ data: Object.values(byStatut) }] }
  });
  new Chart(document.getElementById('topThem'), {
    type: 'bar',
    data: { labels: topThem.map(x=>x[0]), datasets: [{ data: topThem.map(x=>x[1]) }] },
    options: { plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
  });
});
</script>
{% endblock %}
